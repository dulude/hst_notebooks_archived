
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Drizzling WFPC2 Images to use a Single Zeropoint &#8212; HST Notebooks</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/stsci_logo2.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">HST Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    <no title>
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  COS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../COS/README.html">
   COS Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../COS/Setup/Setup.html">
   Setting up your computer environment for working with COS data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../COS/DataDl/DataDl.html">
   Downloading COS Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../COS/ViewData/ViewData.html">
   Viewing COS Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../COS/AsnFile/AsnFile.html">
   Modifying or Creating an Association File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../COS/example_notebook/example_notebook.html">
   Draft: Notebook title
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DrizzlePac
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   DrizzlePac Jupyter Notebook Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../align_to_catalogs/align_to_catalogs.html">
   Aligning HST images to an absolute reference catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../align_multiple_visits/align_multiple_visits.html">
   Optimizing Image Alignment for Multiple HST Visits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../align_sparse_fields/align_sparse_fields.html">
   Aligning Deep Exposures of Sparse Fields
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mask_satellite/mask_satellite.html">
   Satellite Trail Masking Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../optimize_image_sampling/optimize_image_sampling.html">
   Optimizing the Image Sampling
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NICMOS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">
   Programmatic Replacements for NICMOS Units Conversion Form
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="github.com/dulude/hst_notebooks"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="github.com/dulude/hst_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/DrizzlePac/drizzle_wfpc2/drizzle_wfpc2.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/notebooks/DrizzlePac/drizzle_wfpc2/drizzle_wfpc2.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Drizzling WFPC2 Images to use a Single Zeropoint
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-data">
     1. Download the Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-the-wcs">
     2. Update the WCS
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#backup-an-image">
       Backup an Image
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#align-the-images">
     3. Align the Images
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equalize-the-chip-sensitivities">
     4. Equalize the chip sensitivities
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#drizzle-combine-the-images">
     5. Drizzle-combine the images
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#illustration-of-the-effects-of-sensitivity-variation-on-drizzling">
     6. Illustration of the Effects of Sensitivity Variation on Drizzling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simulate-an-image-of-constant-blank-sky-background">
       Simulate an Image of Constant “Blank Sky” Background
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#drizzle-the-original-simulated-image-and-the-equalized-image">
       Drizzle the Original Simulated Image and the Equalized Image
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#display-the-results-of-the-simulation-side-by-side">
       Display The Results of the Simulation Side-by-Side
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this Notebook
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Drizzling WFPC2 Images to use a Single Zeropoint</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Drizzling WFPC2 Images to use a Single Zeropoint
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-data">
     1. Download the Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#update-the-wcs">
     2. Update the WCS
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#backup-an-image">
       Backup an Image
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#align-the-images">
     3. Align the Images
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equalize-the-chip-sensitivities">
     4. Equalize the chip sensitivities
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#drizzle-combine-the-images">
     5. Drizzle-combine the images
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#illustration-of-the-effects-of-sensitivity-variation-on-drizzling">
     6. Illustration of the Effects of Sensitivity Variation on Drizzling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simulate-an-image-of-constant-blank-sky-background">
       Simulate an Image of Constant “Blank Sky” Background
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#drizzle-the-original-simulated-image-and-the-equalized-image">
       Drizzle the Original Simulated Image and the Equalized Image
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#display-the-results-of-the-simulation-side-by-side">
       Display The Results of the Simulation Side-by-Side
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this Notebook
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="drizzling-wfpc2-images-to-use-a-single-zeropoint">
<h1>Drizzling WFPC2 Images to use a Single Zeropoint<a class="headerlink" href="#drizzling-wfpc2-images-to-use-a-single-zeropoint" title="Permalink to this headline">#</a></h1>
<div class="alert-danger">Note: The notebook in this repository 'Initialization.ipynb' goes over many of the basic concepts such as the setup of the environment/package installation and should be read first if you are new to HST images, DrizzlePac, or Astroquery.</div><section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>Extra care must be taken when using <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> to combine observations from detectors comprised of multiple chips of varying sensitivity. <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> works with calibrated images in units of counts (electrons or Data Numbers) or count rates and not in units of flux. It assumes that all input frames can be converted to physical flux units using a single inverse-sensitivity factor, recorded in the FITS image headers as <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code>, and the output drizzled product simply copies the <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> keyword value from the first input image. When this occurs, the inverse-sensitivity will vary across the final drizzled product, and users will need to keep track of which sources fell on which chip when doing photometry. Moreover, varying detector sensitivities will affect the cosmic-ray rejection algorithm used by <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code>, and this may result in the misidentification of some good pixels as cosmic rays.</p>
<p>This is a typical situation when drizzle-combining images from HST instruments with different chip sensitivities, e.g. Wide Field and Planetary Camera 2 (WFPC2). For more detail, see the section on <a class="reference external" href="http://www.stsci.edu/instruments/wfpc2/Wfpc2_dhb/wfpc2_ch53.html">Gain Variation</a> under ‘Position-Dependent Photometric Corrections’ in the WFPC2 Data Handbook. As a result, each of the four chips requires a <a class="reference external" href="http://www.stsci.edu/instruments/wfpc2/Wfpc2_dhb/wfpc2_ch52.html#1933986">unique PHOTFLAM</a> header keyword value. A similar situation may occur when drizzle-combining observations taken over a span of several years as detector’s sensitivity declines over time, see e.g. <a class="reference external" href="https://doi.org/10.3847/0004-6256/152/3/60">ACS ISR 2016-03</a>.</p>
<p>One approach is to rescale the input data so that <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> can properly assume the images/chips have the same sensitivity; that is, a single <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> value can be used to convert re-scaled image counts (or count-rates) to physical <em>integrated</em> flux units. The <code class="docutils literal notranslate"><span class="pre">photeq</span></code> task in <code class="docutils literal notranslate"><span class="pre">Drizzlepac</span></code> automates this image intensity rescaling to a single inverse-sensitivity factor <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code>.</p>
<p>In this example notebook, archival WFPC2 images are used to demonstrate advanced reprocessing using <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> and <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code> for alignment and image combination. The notebook is based on a prior WFPC2 <a class="reference external" href="http://www.stsci.edu/hst/HST_overview/drizzlepac/examples/example7">example</a> but includes additional information about equalizing the chip sensitivities prior to combining.</p>
<p><strong>NOTE:</strong> It is important to note that <code class="docutils literal notranslate"><span class="pre">photeq</span></code> only adjusts image counts so that <em>integrated</em> physical fluxes can be obtained using a single <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code>. It does nothing to account for different throughtputs at different wavelengths.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>

<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span> <span class="nn">stwcs.updatewcs</span> <span class="kn">import</span> <span class="n">updatewcs</span>
<span class="kn">from</span> <span class="nn">drizzlepac</span> <span class="kn">import</span> <span class="n">tweakreg</span><span class="p">,</span> <span class="n">astrodrizzle</span><span class="p">,</span> <span class="n">photeq</span>
<span class="kn">from</span> <span class="nn">stsci.skypac</span> <span class="kn">import</span> <span class="n">skymatch</span>

<span class="c1"># ONLY needed for the simulation section:</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">stwcs.wcsutil</span> <span class="kn">import</span> <span class="n">HSTWCS</span>
<span class="kn">from</span> <span class="nn">drizzlepac.wfpc2Data</span> <span class="kn">import</span> <span class="n">WFPC2_GAINS</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following task in the stsci.skypac package can be run with TEAL:
                                    skymatch                                    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following tasks in the drizzlepac package can be run with TEAL:
    astrodrizzle       config_testbed      imagefindpars           mapreg       
       photeq            pixreplace           pixtopix            pixtosky      
  refimagefindpars       resetbits          runastrodriz          skytopix      
     tweakback            tweakreg           updatenpol
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-the-data">
<h2>1. Download the Data<a class="headerlink" href="#download-the-data" title="Permalink to this headline">#</a></h2>
<p>This example uses WFPC2 observations of Messier 2 in the F814W filter. The data come from GO proposal <a class="reference external" href="http://www.stsci.edu/cgi-bin/get-proposal-info?id=11100&amp;observatory=HST">11100</a> <em>“Two new ‘bullets’ for MOND: revealing the properties of dark matter in massive merging clusters”</em>. Four images were acquired using a 4-pt dither box pattern, followed by two images offset with a dither-line pattern.</p>
<p>The data are downloaded using the <code class="docutils literal notranslate"><span class="pre">astroquery</span></code> API to access the <a class="reference external" href="http://archive.stsci.edu">MAST</a> archive. The <code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code> <a class="reference external" href="http://astroquery.readthedocs.io/en/latest/mast/mast.html">documentation</a> has more examples for how to find and download data from MAST.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve the observation information.</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;mastDownload&#39;</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;mastDownload&#39;</span><span class="p">)</span>
<span class="n">obs_table</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;ua0605*&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s1">&#39;F814W&#39;</span><span class="p">,</span> <span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">)</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs_table</span><span class="p">)</span>

<span class="c1"># Download only the ua0605*_c0m.fits and ua0605*_c1m.fits (DQ) images:</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">mrp_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C0M&#39;</span><span class="p">,</span> <span class="s1">&#39;C1M&#39;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;fits&#39;</span><span class="p">)</span>

<span class="c1"># Move the files from the mastDownload directory to the current working</span>
<span class="c1"># directory and make a backup of the files.</span>
<span class="n">fits_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;mastDownload/HST/ua*/ua*c?m.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">fil</span> <span class="ow">in</span> <span class="n">fits_files</span><span class="p">:</span>
    <span class="n">base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fil</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">base_name</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">base_name</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">fil</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    
<span class="c1"># Delete the mastDownload directory and all subdirectories it contains.</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;mastDownload&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua060502m_c0m.fits to ./mastDownload/HST/ua060502m/ua060502m_c0m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua060502m_c1m.fits to ./mastDownload/HST/ua060502m/ua060502m_c1m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua060504m_c0m.fits to ./mastDownload/HST/ua060504m/ua060504m_c0m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua060504m_c1m.fits to ./mastDownload/HST/ua060504m/ua060504m_c1m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua060506m_c0m.fits to ./mastDownload/HST/ua060506m/ua060506m_c0m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua060506m_c1m.fits to ./mastDownload/HST/ua060506m/ua060506m_c1m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua060508m_c0m.fits to ./mastDownload/HST/ua060508m/ua060508m_c0m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua060508m_c1m.fits to ./mastDownload/HST/ua060508m/ua060508m_c1m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua06050am_c0m.fits to ./mastDownload/HST/ua06050am/ua06050am_c0m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua06050am_c1m.fits to ./mastDownload/HST/ua06050am/ua06050am_c1m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua06050cm_c0m.fits to ./mastDownload/HST/ua06050cm/ua06050cm_c0m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ua06050cm_c1m.fits to ./mastDownload/HST/ua06050cm/ua06050cm_c1m.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
</section>
<section id="update-the-wcs">
<h2>2. Update the WCS<a class="headerlink" href="#update-the-wcs" title="Permalink to this headline">#</a></h2>
<p>WFPC2 images downloaded from the archive contain World Coordinate System (WCS) information based on an older-style description of image distortions. Before these images can be processed with <code class="docutils literal notranslate"><span class="pre">drizzlepac</span></code>, their WCS must be converted to a new format. This can be achieved using <code class="docutils literal notranslate"><span class="pre">updatewcs()</span></code> function from the <code class="docutils literal notranslate"><span class="pre">stwcs</span></code> package. More details may be found here: <a class="reference external" href="http://documents.stsci.edu/hst/HST_overview/documents/DrizzlePac/ch45.html#601857">‘Making WFPC2 Images Compatible with AstroDrizzle’</a>. Note that <code class="docutils literal notranslate"><span class="pre">updatewcs</span></code> is no longer a parameter in AstroDrizzle or TweakReg and must be run separately before processing the data.</p>
<p>First we download the reference files from the CRDS website. See the initialization notebook in this repository for more information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_SERVER_URL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://hst-crds.stsci.edu&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_files&#39;</span><span class="p">))</span>

<span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">&#39;crds bestrefs --files ua0605*_c0m.fits --sync-references=1 --update-bestrefs&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;uref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_files&#39;</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">,</span> <span class="s1">&#39;hst&#39;</span><span class="p">,</span> <span class="s1">&#39;wfpc2&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CalledProcessError</span><span class="g g-Whitespace">                        </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_SERVER_URL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://hst-crds.stsci.edu&#39;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_files&#39;</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">&#39;crds bestrefs --files ua0605*_c0m.fits --sync-references=1 --update-bestrefs&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;uref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_files&#39;</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">,</span> <span class="s1">&#39;hst&#39;</span><span class="p">,</span> <span class="s1">&#39;wfpc2&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/subprocess.py:421,</span> in <span class="ni">check_output</span><span class="nt">(timeout, *popenargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">418</span>         <span class="n">empty</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">419</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span>
<span class="ne">--&gt; </span><span class="mi">421</span> <span class="k">return</span> <span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">popenargs</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">422</span>            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/subprocess.py:526,</span> in <span class="ni">run</span><span class="nt">(input, capture_output, timeout, check, *popenargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">524</span>     <span class="n">retcode</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">525</span>     <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="n">retcode</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">526</span>         <span class="k">raise</span> <span class="n">CalledProcessError</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">527</span>                                  <span class="n">output</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span> <span class="k">return</span> <span class="n">CompletedProcess</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>

<span class="ne">CalledProcessError</span>: Command &#39;crds bestrefs --files ua0605*_c0m.fits --sync-references=1 --update-bestrefs&#39; returned non-zero exit status 127.
</pre></div>
</div>
</div>
</div>
<p><strong>NOTE:</strong> This next step may raise warnings because the Astrometry database is in progress and currently does not cover the entire sky. Please ignore these warnings. The WCS will still be updated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">updatewcs</span><span class="p">(</span><span class="s1">&#39;ua*c0m.fits&#39;</span><span class="p">,</span> <span class="n">use_db</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="backup-an-image">
<h3>Backup an Image<a class="headerlink" href="#backup-an-image" title="Permalink to this headline">#</a></h3>
<p>In a later section we will generate simulated data to illustrate the effects of drizzling WFPC2 images without sensitivity equalization. For that purpose we will need a copy of an original image that has the original inverse-sensitivity values (<code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code>) in their headers. Here we create a backup copy of the first image.</p>
<p><strong>NOTE:</strong> This step is needed for illustration purpose in this notebook only. It is not needed when processing data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orig_image</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;ua*c0m.fits&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">backup_image</span> <span class="o">=</span> <span class="s1">&#39;simulation.fits&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">backup_image</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">backup_image</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">orig_image</span><span class="p">,</span> <span class="n">backup_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="align-the-images">
<h2>3. Align the Images<a class="headerlink" href="#align-the-images" title="Permalink to this headline">#</a></h2>
<p>Due to small pointing errors, the image header WCS typically needs to be updated in order to achieve the best drizzle-combined products. The expected pointing accuracy for various observing scenerios is summarized in the DrizzlePac Handbook <a class="reference external" href="http://documents.stsci.edu/hst/HST_overview/documents/DrizzlePac/AppendixB2.html">Appendix B</a>. Input images must first be aligned so that when the coordinates of a given object (in detector space) are converted to sky coordinates (using the WCS), that object’s sky coordinates must be approximately equal in each frame.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DrizzlePac</span></code> task <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> may be used to correct for any errors in the image header WCS. First, <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> finds sources in each image, matches sources in common across images, and finds a separate linear transformation to align each image. <code class="docutils literal notranslate"><span class="pre">TweakReg</span></code> then computes a new WCS for each image based on this linear transformation.</p>
<p>Here we show a basic image alignment procedure. For a more detailed illustration of image alignment, please refer to other example notebooks such as the mosaic example in this repository.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweakreg</span><span class="o">.</span><span class="n">TweakReg</span><span class="p">(</span><span class="s1">&#39;ua*c0m.fits&#39;</span><span class="p">,</span> <span class="n">updatehdr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reusename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">conv_width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">300.0</span><span class="p">,</span> <span class="n">peakmin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">peakmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="equalize-the-chip-sensitivities">
<h2>4. Equalize the chip sensitivities<a class="headerlink" href="#equalize-the-chip-sensitivities" title="Permalink to this headline">#</a></h2>
<p>This step adjusts image data values so that all images and chips appear (to <code class="docutils literal notranslate"><span class="pre">AstroDrizzle</span></code>) to have a single inverse sensitivity (<code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code>). This can be achieved using the <code class="docutils literal notranslate"><span class="pre">photeq</span></code> task in <code class="docutils literal notranslate"><span class="pre">Drizzlepac</span></code>. This task adjusts image data so that when these data are multiplied by the same single <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> value, the correct flux is obtained.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">photeq</span><span class="o">.</span><span class="n">photeq</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="s1">&#39;ua*_c0m.fits&#39;</span><span class="p">,</span> <span class="n">ref_phot_ext</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the above command, we instruct <code class="docutils literal notranslate"><span class="pre">photeq</span></code> to “equalize” all chips of all input images using the <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> for the <code class="docutils literal notranslate"><span class="pre">WF3</span></code> chip (<code class="docutils literal notranslate"><span class="pre">ref_phot_ext=3</span></code>), using the first image as a reference. This reference <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> value is reported in the log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">REFERENCE</span> <span class="n">VALUE</span> <span class="n">FROM</span> <span class="n">FILE</span><span class="p">:</span> <span class="s1">&#39;ua060502m_c0m.fits[&#39;</span><span class="n">SCI</span><span class="s1">&#39;,1]&#39;</span>
<span class="n">REFERENCE</span> <span class="s1">&#39;PHOTFLAM&#39;</span> <span class="n">VALUE</span> <span class="n">IS</span><span class="p">:</span> <span class="mf">2.507987e-18</span>
</pre></div>
</div>
<p>Upon the completion, <code class="docutils literal notranslate"><span class="pre">photeq</span></code> will not only adjust image data but also update <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> values for all chips to this specific reference value.</p>
</section>
<section id="drizzle-combine-the-images">
<h2>5. Drizzle-combine the images<a class="headerlink" href="#drizzle-combine-the-images" title="Permalink to this headline">#</a></h2>
<p>All four chips are now drizzled together with an output pixel scale set to that of the WF chips:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">astrodrizzle</span><span class="o">.</span><span class="n">AstroDrizzle</span><span class="p">(</span><span class="s1">&#39;ua*c0m.fits&#39;</span><span class="p">,</span>
                          <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">driz_sep_bits</span><span class="o">=</span><span class="s1">&#39;8,1024&#39;</span><span class="p">,</span>
                          <span class="n">driz_sep_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">driz_sep_scale</span><span class="o">=</span><span class="mf">0.0996</span><span class="p">,</span>
                          <span class="n">combine_type</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">,</span>
                          <span class="n">driz_cr_snr</span><span class="o">=</span><span class="s1">&#39;5.5 3.5&#39;</span><span class="p">,</span>
                          <span class="n">driz_cr_scale</span><span class="o">=</span><span class="s1">&#39;2.0 1.5&#39;</span><span class="p">,</span>
                          <span class="n">final_fillval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;8,1024&#39;</span><span class="p">,</span>
                          <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">final_scale</span><span class="o">=</span><span class="mf">0.0996</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drz</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;final_drz_sci.fits&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">drz</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="illustration-of-the-effects-of-sensitivity-variation-on-drizzling">
<h2>6. Illustration of the Effects of Sensitivity Variation on Drizzling<a class="headerlink" href="#illustration-of-the-effects-of-sensitivity-variation-on-drizzling" title="Permalink to this headline">#</a></h2>
<p>The effect of drizzling images with different detector sensitivies, while tangible, is sometimes difficult to <em>visualize</em> in noisy data, especially when drizzling multiple dithered images that can blur the borders between chips.</p>
<p>In this section we produce a simple simulation of observing a constant intensity “blank sky”. We then make a copy of this image and apply sensitivity equalization to it. Finally we drizzle both images and compare them side-by-side.</p>
<section id="simulate-an-image-of-constant-blank-sky-background">
<h3>Simulate an Image of Constant “Blank Sky” Background<a class="headerlink" href="#simulate-an-image-of-constant-blank-sky-background" title="Permalink to this headline">#</a></h3>
<p>In this simple simulation we assume only Poisson noise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">backup_image</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
    <span class="c1"># get chip inverse-sensitivity:</span>
    <span class="n">phot1</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PHOTFLAM&#39;</span><span class="p">]</span>
    <span class="n">phot2</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PHOTFLAM&#39;</span><span class="p">]</span>
    <span class="n">phot3</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PHOTFLAM&#39;</span><span class="p">]</span>
    <span class="n">phot4</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PHOTFLAM&#39;</span><span class="p">]</span>
    
    <span class="c1"># get chip WCS:</span>
    <span class="n">w1</span> <span class="o">=</span> <span class="n">HSTWCS</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">w2</span> <span class="o">=</span> <span class="n">HSTWCS</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">w3</span> <span class="o">=</span> <span class="n">HSTWCS</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">w4</span> <span class="o">=</span> <span class="n">HSTWCS</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">ref_pscale</span> <span class="o">=</span> <span class="n">w4</span><span class="o">.</span><span class="n">idcscale</span>
    
    <span class="c1"># get chip gain:</span>
    <span class="n">cmdgain</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;ATODGAIN&#39;</span><span class="p">]</span>
    <span class="n">gain1</span> <span class="o">=</span> <span class="n">WFPC2_GAINS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">cmdgain</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gain2</span> <span class="o">=</span> <span class="n">WFPC2_GAINS</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">cmdgain</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gain3</span> <span class="o">=</span> <span class="n">WFPC2_GAINS</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">cmdgain</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gain4</span> <span class="o">=</span> <span class="n">WFPC2_GAINS</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">cmdgain</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># final drizzle scale:</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.0996</span>
    
    <span class="c1"># simulated sky level (&quot;true&quot; sky is constant):</span>
    <span class="n">sky</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">phot3</span>

    <span class="c1"># simulate observed counts assuming only Poisson noise:</span>
    <span class="n">conv1a</span> <span class="o">=</span> <span class="n">gain1</span> <span class="o">*</span> <span class="p">(</span><span class="n">w1</span><span class="o">.</span><span class="n">idcscale</span> <span class="o">/</span> <span class="n">ref_pscale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">phot1</span>
    <span class="n">conv1b</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain4</span> <span class="o">/</span> <span class="n">gain1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ref_pscale</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">conv2a</span> <span class="o">=</span> <span class="n">gain2</span> <span class="o">*</span> <span class="p">(</span><span class="n">w2</span><span class="o">.</span><span class="n">idcscale</span> <span class="o">/</span> <span class="n">ref_pscale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">phot2</span>
    <span class="n">conv2b</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain4</span> <span class="o">/</span> <span class="n">gain2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ref_pscale</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">conv3a</span> <span class="o">=</span> <span class="n">gain3</span> <span class="o">*</span> <span class="p">(</span><span class="n">w3</span><span class="o">.</span><span class="n">idcscale</span> <span class="o">/</span> <span class="n">ref_pscale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">phot3</span>
    <span class="n">conv3b</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain4</span> <span class="o">/</span> <span class="n">gain3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ref_pscale</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">conv4a</span> <span class="o">=</span> <span class="n">gain4</span> <span class="o">*</span> <span class="p">(</span><span class="n">w4</span><span class="o">.</span><span class="n">idcscale</span> <span class="o">/</span> <span class="n">ref_pscale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">phot4</span>
    <span class="n">conv4b</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">gain4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ref_pscale</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">conv1a</span> <span class="o">*</span> <span class="n">sky</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">conv1b</span>
    <span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">conv2a</span> <span class="o">*</span> <span class="n">sky</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">conv2b</span>
    <span class="n">h</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">conv3a</span> <span class="o">*</span> <span class="n">sky</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">conv3b</span>
    <span class="n">h</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">conv4a</span> <span class="o">*</span> <span class="n">sky</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">conv4b</span>

<span class="c1"># make a copy of this file:</span>
<span class="n">photeq_image</span> <span class="o">=</span> <span class="s1">&#39;simulation_eq.fits&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">photeq_image</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">photeq_image</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">backup_image</span><span class="p">,</span> <span class="n">photeq_image</span><span class="p">)</span>

<span class="c1"># apply equalization to the image copy:</span>
<span class="n">photeq</span><span class="o">.</span><span class="n">photeq</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="n">photeq_image</span><span class="p">,</span> <span class="n">ref_phot_ext</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="drizzle-the-original-simulated-image-and-the-equalized-image">
<h3>Drizzle the Original Simulated Image and the Equalized Image<a class="headerlink" href="#drizzle-the-original-simulated-image-and-the-equalized-image" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">astrodrizzle</span><span class="o">.</span><span class="n">AstroDrizzle</span><span class="p">(</span>
    <span class="n">backup_image</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s1">&#39;nonequalized.fits&#39;</span><span class="p">,</span>
    <span class="n">stepsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">restore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">in_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">build</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">static</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">skysub</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">blot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">driz_cr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">final_fillval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">final_scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

<span class="n">astrodrizzle</span><span class="o">.</span><span class="n">AstroDrizzle</span><span class="p">(</span>
    <span class="n">photeq_image</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s1">&#39;equalized.fits&#39;</span><span class="p">,</span>
    <span class="n">stepsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">preserve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">restore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">in_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">build</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">static</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">skysub</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">blot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">driz_cr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">final_fillval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">final_bits</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">final_wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">final_scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-the-results-of-the-simulation-side-by-side">
<h3>Display The Results of the Simulation Side-by-Side<a class="headerlink" href="#display-the-results-of-the-simulation-side-by-side" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drz_noneq</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;nonequalized_sci.fits&#39;</span><span class="p">)</span>
<span class="n">drz_eq</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;equalized_sci.fits&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">drz_noneq</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.88</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.08</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Simulation (Not equalized)&#39;</span><span class="p">)</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">drz_eq</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.88</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.08</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Equalized Simulated Image&#39;</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x1</span>
<span class="n">ax_cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">ax_cbar</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="about-this-notebook">
<h1>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Author: M. Cara, STScI Data Analysis Tools Branch
Updated: December 14, 2018
</pre></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "dulude/hst_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/DrizzlePac/drizzle_wfpc2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>